{% extends "v-0.9.3/base/base.html"%} {% load static %} {% block head %}
<script type="text/javascript" src="{% static 'codebase/webix.js' %}"></script>

<script>
      const tableData = async () => {
        var params = window.location.search;
        var url = `{% url 'v-0.9.3/candidate-listCreateAPI-View' %}${params}`; 
        console.log("url",url)
        const response = await fetch(url, {
          method: "GET",
          headers: {
            "Content-Type": "application/json",
          },
        });
        var data = await response.json();
        console.log("data",data)
        //data = data.data
        for (let i = 0; i < data.length; i++) {
           data[i].status?.name
          ? (data[i].status = data[i].status.name)
          : (data[i].status = "");
          data[i].priority?.name
            ? (data[i].priority = data[i].priority.name)
            : (data[i].priority = "");
        }
        return data;
      };

</script>


{% endblock %} {% block content %}

<div class="page-wrapper">
  <!-- Container fluid  -->
  <div class="container-fluid">
    <!-- Start Page Content -->
    <div class="pagetitle">
      <h3>Candidates</h3>
    </div>
    <script type="text/javascript" charset="utf-8">
      // Webix Prep
      var url = " {% url 'v-0.9.3/view-candidate' pk='123456' %}";
      var url2 = "{% url 'v-0.9.3/candidate-listCreateAPI-View' %}";

      webix.ready(function () {
        gridA = webix.ui({
          id: "qbcudpyz",
          container: "webix_datatable",
          select: "row",
          view: "datatable",
         
          minHeight: 800,
          leftSplit: 4,
          rightSplit: 0,
          columns: [
            {
              header: "Action",
              template:
                "<div class='link'> <a class='viewbtn' type='button'>View</a> </div>",
              width: 50,
            },
            {
              id: "year",
              header: {
                text: "Year",
                autoheight: true,
                //css: "multiline",
                content: "excelFilter",
                mode: "number",
              },
              cssFormat: "",
              sort: "string",
              width: 60,
              hidden: 0,
            },
            {
              id: "ww",
              header: {
                text: "WW",
                autoheight: true,
                //css: "multiline",
                content: "excelFilter",
                mode: "number",
              },
              cssFormat: "",
              sort: "string",
              width: 60,
              hidden: 0,
            },
            {
              id: "first_name",
              header: {
                text: "First Name",
                autoheight: true,
                //css: "multiline",
                content: "excelFilter",
                mode: "text",
              },
              cssFormat: "",
              sort: "string",
              width: 100,
              hidden: 0,
            },
            {
              id: "last_name",
              header: {
                text: "Last Name",
                autoheight: true,
                content: "excelFilter",
                css: "multiline",
                mode: "text",
              },
              cssFormat: "",
              sort: "string",
              width: 100,
              hidden: 0,
            },
            {
              id: "plateformOrReferral",
              header: {
                text: "plateform/Referral",
                autoheight: true,
                content: "excelFilter",
                css: "multiline",
                mode: "text",
              },
              cssFormat: "",
              sort: "string",
              width: 157,
              hidden: 0,
            },
            {
              id: "positionOrPerson",
              header: {
                text: "Position/Person",
                autoheight: true,
                content: "excelFilter",
                css: "multiline",
                mode: "text",
              },
              cssFormat: "",
              sort: "string",
              width: 142,
              hidden: 0,
            },
            {
              id: "refferedBy",
              header: {
                text: "Reffered By",
                autoheight: true,
                content: "excelFilter",
                css: "multiline",
                mode: "text",
              },
              cssFormat: "",
              sort: "string",
              width: 110,
              hidden: 0,
            },
            {
              id: "skillLevel",
              header: {
                text: "Skill Level",
                autoheight: true,
                content: "excelFilter",
                css: "multiline",
                mode: "text",
              },
              cssFormat: "",
              sort: "string",
              width: 100,
              hidden: 0,
            },
            {
              id: "specialitySkillSet",
              header: {
                text: "Speciality Skill Set",
                autoheight: true,
                content: "excelFilter",
                css: "multiline",
                mode: "text",
              },
              cssFormat: "",
              sort: "string",
              width: 100,
              hidden: 0,
            },
            {
              id: "semi",
              header: {
                text: "Semi",
                autoheight: true,
                content: "excelFilter",
                css: "multiline",
                mode: "text",
              },
              cssFormat: "",
              sort: "string",
              width: 100,
              hidden: 0,
            },
            {
              id: "intel",
              header: {
                text: "Intel",
                autoheight: true,
                content: "excelFilter",
                css: "multiline",
                mode: "text",
              },
              cssFormat: "",
              sort: "string",
              width: 100,
              hidden: 0,
            },
            {
              id: "project1",
              header: {
                text: "Project 1",
                autoheight: true,
                content: "excelFilter",
                css: "multiline",
                mode: "text",
              },
              cssFormat: "",
              sort: "string",
              width: 100,
              hidden: 0,
            },
            {
              id: "project2",
              header: {
                text: "Project 2",
                autoheight: true,
                content: "excelFilter",
                css: "multiline",
                mode: "text",
              },
              cssFormat: "",
              sort: "string",
              width: 100,
              hidden: 0,
            },
            {
              id: "project3",
              header: {
                text: "Project 3",
                autoheight: true,
                content: "excelFilter",
                css: "multiline",
                mode: "text",
              },
              cssFormat: "",
              sort: "string",
              width: 100,
              hidden: 0,
            },
            {
              id: "status",
              header: {
                text: "Status",
                autoheight: true,
                content: "excelFilter",
                css: "multiline",
                mode: "text",
              },
              cssFormat: "",
              sort: "string",
              width: 100,
              hidden: 0,
            },
            {
              id: "priority",
              header: {
                text: "Priority",
                autoheight: true,
                content: "excelFilter",
                css: "multiline",
                mode: "text",
              },
              cssFormat: "",
              sort: "string",
              width: 100,
              hidden: 0,
              template: function (obj) {
                if (obj.status?.name) {
                  return obj.priority.name;
                } else {
                  return " ";
                }
              },
            },
            {
              id: "activity",
              header: {
                text: "Activity",
                autoheight: true,
                content: "excelFilter",
                css: "multiline",
                mode: "text",
              },
              cssFormat: "",
              sort: "string",
              width: 100,
              hidden: 0,
            },
            {
              id: "pay",
              header: {
                text: "$$$$$$$$",
                autoheight: true,
                content: "excelFilter",
                css: "multiline",
                mode: "text",
              },
              cssFormat: "",
              sort: "string",
              width: 100,
              hidden: 0,
            },
            {
              id: "skill_keywords_full",
              header: {
                text: "Skills",
                autoheight: true,
                css: "multiline",
                content: "excelFilter",
                mode: "number",
              },
              sort: "string",
              width: 150,
              hidden: 0,
            },
            {
              id: "phone",
              header: {
                text: "Phone",
                autoheight: true,
                content: "excelFilter",
                css: "multiline",
                mode: "text",
              },
              cssFormat: "",
              sort: "string",
              width: 100,
              hidden: 0,
            },
            {
              id: "Email",
              header: {
                text: "Email",
                autoheight: true,
                content: "excelFilter",
                css: "multiline",
                mode: "text",
              },
              cssFormat: "",
              sort: "string",
              width: 100,
              hidden: 0,
            },
            {
              id: "city",
              header: {
                text: "City",
                autoheight: true,
                content: "excelFilter",
                css: "multiline",
                mode: "text",
              },
              cssFormat: "",
              sort: "string",
              width: 100,
              hidden: 0,
            },
            {
              id: "state",
              header: {
                text: "State",
                autoheight: true,
                content: "excelFilter",
                css: "multiline",
                mode: "text",
              },
              cssFormat: "",
              sort: "string",
              width: 100,
              hidden: 0,
            },
          ],
          data: tableData(),
          on: {
            onItemClick(){
            this.hideOverlay();
            return ;
           },
            onBeforeRender: function () {
              
              this.showOverlay(`<div class="webix_loader"></div><br><span class="load_text">Loading Data...</span>`);
            },
            onAfterLoad: function () {
              if (!this.count()) this.showOverlay("Sorry, there is no data");
              else this.hideOverlay();
            },
          },
          /*url: function () {
            return webix.promise(function (res) {
              setTimeout(function () {
                console.log("url",url)
                console.log("url2",url2)
                console.log("res",res)
                console.log("webix.ajax",webix.ajax)
                res(webix.ajax(url2));
              }, 1000);
            });
          },*/
          onClick: {
            viewbtn: function (e, id, trg) {
              data = this.getItem(id);
              console.log("url",url)
              Url = url.replace("123456", data.candidate_id);
              console.log("Url",Url)
              webix.send(Url, {}, "get");
            },
          },
          /*on: {
            onItemDblClick: function () {
              var row_id = gridA.getSelectedId(true, true);
              act_upon_function(row_id);
            },
          },*/
        });
         gridA.attachEvent("onAfterFilter", function(){
          this.hideOverlay()
        })
        
        gridA.attachEvent("onAfterSort", function(){
          this.hideOverlay()
      });
      });

   
    </script>
    <div id="webix_datatable"></div>
  </div>
</div>

{% endblock %}
